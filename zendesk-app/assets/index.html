<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>顧客リスク分析</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app-root">
    <div id="app">
      <!-- ローディング -->
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>読み込み中...</p>
      </div>

      <!-- エラー表示 -->
      <div id="error" class="error-message" style="display: none;"></div>

      <!-- メインコンテンツ -->
      <div id="content" class="app-container" style="display: none;">
      
      <!-- 上部固定：要約ボタン2つ横並び -->
      <div class="top-actions">
        <button id="current-ticket-btn" class="btn-primary">
          <span class="btn-text">このチケットを要約</span>
        </button>
        <button id="summarize-selected-btn" class="btn-secondary-alt" disabled>
          <span class="btn-icon">☑️</span>
          <span class="btn-text">選択を要約</span>
        </button>
      </div>

      <!-- スクロール可能なLINE履歴エリア -->
      <div class="line-area">
        <!-- 顧客リスク指標（非表示） -->
        <div id="customer-risk" class="risk-panel" style="display: none;">
          <h3 class="section-title">⚠️ 顧客リスク指標</h3>
          <div class="risk-meter">
            <div id="risk-level" class="risk-level">通常</div>
            <div class="risk-bar">
              <div id="risk-bar-fill" class="risk-bar-fill" style="width: 0%"></div>
            </div>
            <div id="risk-score" class="risk-score">0</div>
          </div>
          <div id="risk-details" class="risk-details"></div>
        </div>

        <!-- 要約結果エリア -->
        <div id="summary-container" class="summary-container" style="display: none;">
          <div class="summary-header">
            <h3 class="section-title">📋 AI要約</h3>
            <button id="close-summary" class="btn-close">×</button>
          </div>
          
          <!-- LINE風吹き出し表示（動的生成・時系列順） -->
          <div id="summary-chat-container" class="summary-line-chat"></div>

          <!-- このチケットを表示ボタン（要約内） -->
          <div class="summary-actions">
            <button id="show-current-ticket-btn" class="btn-secondary">
              <span class="btn-icon">🎫</span>
              <span class="btn-text">このチケットを表示</span>
            </button>
          </div>
        </div>

        <!-- チケット履歴一覧 -->
        <div id="ticket-history" class="ticket-history">
          <h3 class="section-title">📜 過去の問い合わせ履歴</h3>
          <div id="ticket-list" class="ticket-list"></div>
          <div id="no-tickets" class="no-tickets" style="display: none;">
            過去のチケットはありません
          </div>
        </div>

        <!-- 顧客メモ -->
        <div id="alert-memo" class="alert-memo">
          <h3 class="section-title">⚡ 顧客メモ</h3>
          <textarea id="memo-input" class="memo-input" placeholder="この顧客に関する注意事項を入力..."></textarea>
          <button id="save-memo-btn" class="btn-secondary">
            <span class="btn-icon">💾</span>
            <span class="btn-text">メモを保存</span>
          </button>
        </div>
      </div>

      <!-- 下部固定：削除（要約内に移動） -->

      </div>
    </div>
  </div>
  
  <script src="https://static.zdassets.com/zendesk_app_framework_sdk/2.0/zaf_sdk.min.js"></script>
  <script src="main.js" defer></script>
</body>
</html>
